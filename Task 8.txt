#nullable disable
using System;
using System.Collections.Generic;

public class MyArrayList<T>
{
    private T[] elementData;   // массив для хранения элементов
    private int size;          // текущее количество элементов

    private const int DEFAULT_CAPACITY = 10;

    // 1) для создания пустого динамического массива
    public MyArrayList()
    {
        elementData = new T[DEFAULT_CAPACITY];
        size = 0;
    }

    // 2) для создания массива из готового массива a
    public MyArrayList(T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a), "Массив не должен быть null.");

        elementData = new T[Math.Max(DEFAULT_CAPACITY, a.Length)];
        size = a.Length;

        Array.Copy(a, elementData, size);
    }

    // 3) для создания пустого массива с заданной ёмкостью
    public MyArrayList(int capacity)
    {
        if (capacity < 0)
            throw new ArgumentException("Ёмкость не может быть отрицательной.");

        elementData = new T[capacity];
        size = 0;
    }

    // Вспомогательное

    // для увеличения внутреннего массива при переполнении
    private void EnsureCapacity(int minCapacity)
    {
        if (minCapacity <= elementData.Length)
            return;

        int newCapacity = (int)(elementData.Length * 1.5) + 1;
        if (newCapacity < minCapacity)
            newCapacity = minCapacity;

        T[] newArray = new T[newCapacity];
        Array.Copy(elementData, newArray, size);
        elementData = newArray;
    }

    // для проверки индекса на корректность (0..size-1)
    private void CheckIndex(int index)
    {
        if (index < 0 || index >= size)
            throw new ArgumentOutOfRangeException(nameof(index), "Индекс вне диапазона.");
    }

    // для проверки индекса вставки (0..size)
    private void CheckIndexForAdd(int index)
    {
        if (index < 0 || index > size)
            throw new ArgumentOutOfRangeException(nameof(index), "Индекс вставки вне диапазона.");
    }

    // 4) для добавления элемента в конец массива
    public void Add(T e)
    {
        if (e == null)
            throw new ArgumentNullException(nameof(e), "Нельзя добавить null.");

        EnsureCapacity(size + 1);
        elementData[size] = e;
        size++;
    }

    // 5) для добавления всех элементов из массива
    public void AddAll(T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a));

        EnsureCapacity(size + a.Length);
        foreach (T item in a)
        {
            Add(item);
        }
    }

    // 6) для удаления всех элементов
    public void Clear()
    {
        size = 0;
    }

    // 7) для проверки, есть ли объект в массиве
    public bool Contains(object o)
    {
        return IndexOf(o) != -1;
    }

    // 8) для проверки, содержатся ли все элементы массива a
    public bool ContainsAll(T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a));

        foreach (T item in a)
        {
            if (!Contains(item))
                return false;
        }

        return true;
    }

    // 9) для проверки, пуст ли массив
    public bool IsEmpty()
    {
        return size == 0;
    }

    // 10) для удаления указанного объекта
    public bool Remove(object o)
    {
        int index = IndexOf(o);
        if (index == -1)
            return false;

        Remove(index);
        return true;
    }

    // 11) для удаления всех указанных объектов
    public bool RemoveAll(T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a));

        bool changed = false;
        foreach (T item in a)
        {
            while (Remove(item))
            {
                changed = true;
            }
        }
        return changed;
    }

    // 12) для оставления только элементов из массива a
    public bool RetainAll(T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a));

        bool changed = false;

        for (int i = 0; i < size; i++)
        {
            if (!ArrayContains(a, elementData[i]))
            {
                Remove(i);
                i--;
                changed = true;
            }
        }

        return changed;
    }

    // для проверки, есть ли value в массиве a
    private bool ArrayContains(T[] a, T value)
    {
        foreach (T item in a)
        {
            if (item.Equals(value))
                return true;
        }
        return false;
    }

    // 13) для получения размера
    public int Size()
    {
        return size;
    }

    // 14) для возврата массива объектов
    public object[] ToArray()
    {
        object[] result = new object[size];
        Array.Copy(elementData, result, size);
        return result;
    }

    // 15) для возврата массива T (если a null — создаём новый)
    public T[] ToArray(T[] a)
    {
        if (a == null || a.Length < size)
            a = new T[size];

        Array.Copy(elementData, a, size);
        return a;
    }

    // 16) для вставки элемента в позицию index
    public void Add(int index, T e)
    {
        if (e == null)
            throw new ArgumentNullException(nameof(e));

        CheckIndexForAdd(index);
        EnsureCapacity(size + 1);

        for (int i = size; i > index; i--)
        {
            elementData[i] = elementData[i - 1];
        }

        elementData[index] = e;
        size++;
    }

    // 17) для вставки массива в позицию index
    public void AddAll(int index, T[] a)
    {
        if (a == null)
            throw new ArgumentNullException(nameof(a));

        CheckIndexForAdd(index);
        EnsureCapacity(size + a.Length);

        // сдвигаем хвост вправо
        for (int i = size - 1; i >= index; i--)
        {
            elementData[i + a.Length] = elementData[i];
        }

        // вставляем новые элементы
        for (int i = 0; i < a.Length; i++)
        {
            elementData[index + i] = a[i];
        }

        size += a.Length;
    }

    // 18) для получения элемента по индексу
    public T Get(int index)
    {
        CheckIndex(index);
        return elementData[index];
    }

    // 19) для поиска первого вхождения объекта
    public int IndexOf(object o)
    {
        if (o == null)
            return -1;

        for (int i = 0; i < size; i++)
        {
            if (elementData[i].Equals(o))
                return i;
        }

        return -1;
    }

    // 20) для поиска последнего вхождения объекта
    public int LastIndexOf(object o)
    {
        if (o == null)
            return -1;

        for (int i = size - 1; i >= 0; i--)
        {
            if (elementData[i].Equals(o))
                return i;
        }

        return -1;
    }

    // 21) для удаления элемента по индексу и возврата его
    public T Remove(int index)
    {
        CheckIndex(index);

        T removed = elementData[index];

        for (int i = index; i < size - 1; i++)
        {
            elementData[i] = elementData[i + 1];
        }

        size--;
        return removed;
    }

    // 22) для замены элемента по индексу
    public T Set(int index, T e)
    {
        if (e == null)
            throw new ArgumentNullException(nameof(e));

        CheckIndex(index);

        T oldValue = elementData[index];
        elementData[index] = e;
        return oldValue;
    }

    // 23) для получения подсписка [fromIndex; toIndex)
    public MyArrayList<T> SubList(int fromIndex, int toIndex)
    {
        if (fromIndex < 0 || toIndex > size || fromIndex > toIndex)
            throw new ArgumentOutOfRangeException("Неверный диапазон индексов.");

        int newLength = toIndex - fromIndex;
        T[] newArray = new T[newLength];

        for (int i = 0; i < newLength; i++)
        {
            newArray[i] = elementData[fromIndex + i];
        }

        return new MyArrayList<T>(newArray);
    }
}

// для тестировния
class Program
{
    static void Main(string[] args)
    {
        MyArrayList<int> list = new MyArrayList<int>();

        list.Add(10);
        list.Add(20);
        list.Add(30);

        list.Add(1, 15); // вставка в середину

        Console.WriteLine("Size = " + list.Size());          // 4
        Console.WriteLine("Get(1) = " + list.Get(1));        // 15
        Console.WriteLine("IndexOf(30) = " + list.IndexOf(30)); // 3

        list.Remove(2); // удаляем 20
        Console.WriteLine("После Remove(2), Size = " + list.Size()); // 3

        MyArrayList<int> sub = list.SubList(0, 2);
        Console.WriteLine("SubList size = " + sub.Size());   // 2
    }
}

